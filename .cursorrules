# Cursor Rules for Online Course Platform

## í”„ë¡œì íŠ¸ ê°œìš”
ì´ í”„ë¡œì íŠ¸ëŠ” Next.js 14 ê¸°ë°˜ì˜ ì˜¨ë¼ì¸ êµìœ¡ í”Œë«í¼ì…ë‹ˆë‹¤. DevSecOps, í´ë¼ìš°ë“œ ë³´ì•ˆ, AI/SNS ê´€ë ¨ ë™ì˜ìƒ ê°•ì˜ì™€ ìê²©ì¦ êµìœ¡ì„ ì œê³µí•©ë‹ˆë‹¤.

**ë„ë©”ì¸**: https://edu.2twodragon.com

## í•µì‹¬ ì›ì¹™

### 1. ë³´ì•ˆ ìš°ì„  (Security First)
- ëª¨ë“  ì½”ë“œ, ì„¤ì •, ì•„í‚¤í…ì²˜ ì œì•ˆì€ ë³´ì•ˆì„ ìµœìš°ì„ ìœ¼ë¡œ ê³ ë ¤
- ìµœì†Œ ê¶Œí•œ ì›ì¹™(Principle of Least Privilege) ì ìš©
- Defense in Depth ì „ëµ ê³ ë ¤
- ë¯¼ê°í•œ ì •ë³´(API í‚¤, ë¹„ë°€ë²ˆí˜¸, í† í° ë“±)ëŠ” ì ˆëŒ€ í•˜ë“œì½”ë”©í•˜ì§€ ì•ŠìŒ
- OWASP Top 10 (2025) ì·¨ì•½ì  ë°©ì§€
- ISMS-P ê¸°ì¤€ ì¤€ìˆ˜

### 2. ì‹¤ë¬´ ì¤‘ì‹¬ (Practical Focus)
- ì´ë¡ ë³´ë‹¤ ì‹¤ë¬´ ê²½í—˜ê³¼ ì‹¤ì œ ì‚¬ìš© ì‚¬ë¡€ ì¤‘ì‹¬
- êµ¬ì²´ì ì¸ ì½”ë“œ ì˜ˆì œì™€ ì„¤ì • íŒŒì¼ ì œê³µ
- ë¬¸ì œ í•´ê²° ê³¼ì •ê³¼ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… í¬í•¨
- ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œì˜ ê³ ë ¤ì‚¬í•­ ì–¸ê¸‰

### 3. íƒ€ì… ì•ˆì „ì„± (Type Safety)
- TypeScript strict mode í•„ìˆ˜
- any íƒ€ì… ì‚¬ìš© ìµœì†Œí™”
- ì¸í„°í˜ì´ìŠ¤ì™€ íƒ€ì… ì •ì˜ ëª…í™•íˆ

---

## ê¸°ìˆ  ìŠ¤íƒ

### í”„ë ˆì„ì›Œí¬ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript (strict mode)
- **UI Components**: ShadCN UI (`/components/ui`)
- **Icons**: Lucide React
- **Styling**: Tailwind CSS
- **Database**: PostgreSQL + Prisma ORM
- **Authentication**: NextAuth v4
- **AI Services**: DeepSeek (primary), Gemini (fallback), OpenAI (Pro)
- **Payments**: Stripe, PayPal
- **Caching**: Redis (Upstash compatible)

### ShadCN Components
- ëª¨ë“  UI ì»´í¬ë„ŒíŠ¸ëŠ” ShadCN ì‚¬ìš©
- ì»´í¬ë„ŒíŠ¸ ê²½ë¡œ: `/components/ui`
- ì„¤ì¹˜ ëª…ë ¹: `npx shadcn@latest add [component-name]`
  - ì°¸ê³ : `npx shadcn-ui@latest add`ëŠ” deprecated

### Icons
- ëª¨ë“  ì•„ì´ì½˜ì€ Lucide React ì‚¬ìš©
- ì„í¬íŠ¸ í˜•ì‹: `import { IconName } from "lucide-react"`
- ì˜ˆì‹œ: `import { Search, Menu, Play } from "lucide-react"`

### ê°œë°œ ë„êµ¬
- **oh-my-opencode**: ê°œë°œ ë„êµ¬ ì„¤ì¹˜ (ì„ íƒì‚¬í•­)
  - ì„¤ì¹˜: `npm run setup:oh-my-opencode`
  - ë˜ëŠ”: `./scripts/setup-oh-my-opencode.sh`
  - Cursor IDEì™€ í„°ë¯¸ë„ì—ì„œ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥

---

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
online-course/
â”œâ”€â”€ app/                    # Next.js 14 App Router
â”‚   â”œâ”€â”€ api/               # API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ auth/          # NextAuth ì¸ì¦
â”‚   â”‚   â”œâ”€â”€ chat/          # AI ì±—ë´‡ API
â”‚   â”‚   â”œâ”€â”€ courses/       # ì½”ìŠ¤ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ webhooks/      # Stripe/PayPal ì›¹í›…
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ (pages)/           # UI í˜ì´ì§€
â”‚   â”œâ”€â”€ layout.tsx         # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â””â”€â”€ page.tsx           # ëœë”© í˜ì´ì§€
â”œâ”€â”€ components/            # React ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ ui/               # ShadCN UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ chat-bot.tsx      # AI ì±—ë´‡
â”‚   â”œâ”€â”€ video-summary.tsx # ë¹„ë””ì˜¤ ìš”ì•½
â”‚   â””â”€â”€ ...
â”œâ”€â”€ lib/                   # í•µì‹¬ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ auth.ts           # NextAuth ì„¤ì •
â”‚   â”œâ”€â”€ security.ts       # ë³´ì•ˆ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ prisma.ts         # Prisma í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ ...
â”œâ”€â”€ prisma/               # ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ schema.prisma    # DB ìŠ¤í‚¤ë§ˆ
â”‚   â””â”€â”€ migrations/      # ë§ˆì´ê·¸ë ˆì´ì…˜
â”œâ”€â”€ types/                # TypeScript íƒ€ì…
â””â”€â”€ middleware.ts         # ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
```

---

## ë³´ì•ˆ ê·œì¹™

### OWASP Top 10 (2025) ëŒ€ì‘

#### A01: Broken Access Control
- ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì— ì¸ì¦/ì¸ê°€ ê²€ì¦ í•„ìˆ˜
- NextAuth ì„¸ì…˜ ê²€ì¦ ì‚¬ìš©
- ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´(RBAC) ì ìš©

```typescript
// ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
import { getServerSession } from 'next-auth/next';
import { authOptions } from '@/lib/auth';

export async function GET(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }
  // ...
}
```

#### A02: Cryptographic Failures
- ë¹„ë°€ë²ˆí˜¸ëŠ” bcrypt (salt rounds 12 ì´ìƒ) ì‚¬ìš©
- HTTPS í•„ìˆ˜ (í”„ë¡œë•ì…˜ í™˜ê²½)
- ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” ì €ì¥

#### A03: Injection
- Prisma ORMì˜ parameterized queries ì‚¬ìš©
- ì‚¬ìš©ì ì…ë ¥ í•­ìƒ sanitize
- `lib/security.ts`ì˜ `sanitizeInput()` ì‚¬ìš©

```typescript
import { sanitizeInput } from '@/lib/security';

const safeInput = sanitizeInput(userInput);
```

#### A04: Insecure Design
- ë³´ì•ˆì„ ê³ ë ¤í•œ ì„¤ê³„
- Rate limiting ì ìš©
- ì…ë ¥ ê²€ì¦ í•„ìˆ˜

#### A05: Security Misconfiguration
- ê¸°ë³¸ ìê²© ì¦ëª… ì‚¬ìš© ê¸ˆì§€
- ë””ë²„ê·¸ ëª¨ë“œëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ
- ë³´ì•ˆ í—¤ë” ì„¤ì • (CSP, HSTS ë“±)

#### A06: Vulnerable Components
- ì •ê¸°ì ì¸ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸
- `npm audit` ì •ê¸° ì‹¤í–‰
- Dependabot í™œì„±í™”

#### A07: Identification and Authentication Failures
- ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ì •ì±… (8ì ì´ìƒ, ëŒ€ì†Œë¬¸ì, ìˆ«ì)
- ì„¸ì…˜ ê´€ë¦¬ ë³´ì•ˆ (httpOnly, secure, sameSite)
- OAuth 2.0 ì‚¬ìš© (Google)

#### A08: Software and Data Integrity Failures
- Stripe webhook signature ê²€ì¦
- ì˜ì¡´ì„± ë¬´ê²°ì„± í™•ì¸

#### A09: Security Logging and Monitoring Failures
- ë³´ì•ˆ ì´ë²¤íŠ¸ ë¡œê¹…
- ë¯¼ê° ì •ë³´ëŠ” ë¡œê·¸ì—ì„œ ì œì™¸

#### A10: Server-Side Request Forgery (SSRF)
- URL í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ì ìš©
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ ì°¨ë‹¨

### ë¯¼ê° ì •ë³´ ì²˜ë¦¬

#### ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­
- âŒ API í‚¤, ë¹„ë°€ë²ˆí˜¸, í† í° í•˜ë“œì½”ë”©
- âŒ .env íŒŒì¼ Git ì»¤ë°‹
- âŒ í´ë¼ì´ì–¸íŠ¸ì— ì‹œí¬ë¦¿ ë…¸ì¶œ
- âŒ ë¡œê·¸ì— ë¯¼ê° ì •ë³´ ì¶œë ¥
- âŒ `eval()`, `new Function()` ì‚¬ìš©

#### í•„ìˆ˜ ì‚¬í•­
- âœ… í™˜ê²½ ë³€ìˆ˜ë¡œ ì‹œí¬ë¦¿ ê´€ë¦¬
- âœ… .gitignoreì— .env* í¬í•¨
- âœ… ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ API í‚¤ ì‚¬ìš©
- âœ… ì…ë ¥ê°’ ê²€ì¦ ë° sanitization

### XSS ë°©ì§€

#### dangerouslySetInnerHTML ì‚¬ìš© ì‹œ
- ë°˜ë“œì‹œ escapeHtml ì ìš© í›„ ì‚¬ìš©
- AI ì‘ë‹µ ë“± ì™¸ë¶€ ë°ì´í„°ëŠ” í•­ìƒ escape

```typescript
// ì˜¬ë°”ë¥¸ ì˜ˆì‹œ
function escapeHtml(text: string): string {
  return text
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#x27;');
}

<div dangerouslySetInnerHTML={{
  __html: escapeHtml(content)
    .replace(/\n/g, '<br/>')
}} />
```

### Rate Limiting
- Redis ê¸°ë°˜ rate limiting ì‚¬ìš©
- API ì—”ë“œí¬ì¸íŠ¸ë³„ ì œí•œ ì ìš©
- `lib/security.ts`ì˜ `checkRateLimit()` ì‚¬ìš©

```typescript
import { checkRateLimit, getClientIp } from '@/lib/security';

const clientIp = getClientIp(request);
const rateLimit = await checkRateLimit(`api:${clientIp}`, 10, 60000);
if (!rateLimit.allowed) {
  return NextResponse.json({ error: 'Too many requests' }, { status: 429 });
}
```

---

## ì½”ë“œ ì‘ì„± ê·œì¹™

### TypeScript
- strict mode í™œì„±í™”
- any íƒ€ì… ì‚¬ìš© ìµœì†Œí™”
- ì¸í„°í˜ì´ìŠ¤/íƒ€ì… ëª…í™•íˆ ì •ì˜
- ë„ ì²´í¬ í•„ìˆ˜

```typescript
// ì¢‹ì€ ì˜ˆì‹œ
interface User {
  id: string;
  email: string;
  name: string | null;
}

// ë‚˜ìœ ì˜ˆì‹œ
const user: any = await getUser();
```

### React/Next.js
- ì„œë²„ ì»´í¬ë„ŒíŠ¸ ê¸°ë³¸ ì‚¬ìš©
- í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ëŠ” 'use client' ëª…ì‹œ
- ì—ëŸ¬ ë°”ìš´ë”ë¦¬ ì ìš©
- Suspenseë¡œ ë¡œë”© ìƒíƒœ ì²˜ë¦¬

### API ë¼ìš°íŠ¸
- ì…ë ¥ ê²€ì¦ í•„ìˆ˜
- ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œ ë°˜í™˜
- ì—ëŸ¬ ë©”ì‹œì§€ì— ë¯¼ê° ì •ë³´ í¬í•¨ ê¸ˆì§€

```typescript
export async function POST(request: Request) {
  try {
    // 1. Rate limiting
    // 2. ì¸ì¦ í™•ì¸
    // 3. ì…ë ¥ ê²€ì¦
    // 4. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    // 5. ì‘ë‹µ ë°˜í™˜
  } catch (error) {
    console.error('Error:', error instanceof Error ? error.message : 'Unknown');
    return NextResponse.json(
      { error: 'ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' },
      { status: 500 }
    );
  }
}
```

### Prisma
- parameterized queries ì‚¬ìš© (ê¸°ë³¸)
- íŠ¸ëœì­ì…˜ ì ì ˆíˆ ì‚¬ìš©
- ì—ëŸ¬ ì²˜ë¦¬ í•„ìˆ˜

---

## í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

### í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜
```bash
# Database
DATABASE_URL="postgresql://..."

# NextAuth
NEXTAUTH_SECRET="min-32-characters"
NEXTAUTH_URL="https://edu.2twodragon.com"

# Google OAuth
GOOGLE_CLIENT_ID="..."
GOOGLE_CLIENT_SECRET="..."

# AI Services
DEEPSEEK_API_KEY="sk-..."      # Primary
GEMINI_API_KEY="..."           # Fallback
OPENAI_API_KEY="sk-..."        # Pro plan

# Payments
STRIPE_SECRET_KEY="sk_..."
STRIPE_WEBHOOK_SECRET="whsec_..."

# Redis
REDIS_URL="redis://..."
```

### ê²€ì¦ ê·œì¹™
- NEXTAUTH_SECRET: 32ì ì´ìƒ
- DEEPSEEK_API_KEY: `sk-`ë¡œ ì‹œì‘
- STRIPE_SECRET_KEY: `sk_live_` ë˜ëŠ” `sk_test_`ë¡œ ì‹œì‘

---

## AI ì±—ë´‡ ê·œì¹™

### ë³´ì•ˆ
- API í‚¤ëŠ” ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©
- Rate limiting: ì„¸ì…˜ë‹¹ 10íšŒ/ë¶„ (Basic), 100íšŒ/ë¶„ (Pro)
- ì…ë ¥ ê¸¸ì´ ì œí•œ: 5000ì
- XSS ë°©ì§€ ì ìš©

### ì‘ë‹µ ì²˜ë¦¬
- íƒ€ì„ì•„ì›ƒ: 25ì´ˆ
- ìµœëŒ€ í† í°: 1500
- ì—ëŸ¬ ì‹œ fallback (DeepSeek â†’ Gemini)

### ë¹„ìš© ìµœì í™”
- DeepSeek ìš°ì„  ì‚¬ìš© (ë¹„ìš© íš¨ìœ¨)
- ìºì‹± ì ìš© (Redis)

---

## í…ŒìŠ¤íŠ¸ ë° í’ˆì§ˆ

### ì½”ë“œ ë¦¬ë·° ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] TypeScript íƒ€ì… ì˜¤ë¥˜ ì—†ìŒ
- [ ] ë³´ì•ˆ ì·¨ì•½ì  ì—†ìŒ (XSS, CSRF, SQL Injection ë“±)
- [ ] ë¯¼ê° ì •ë³´ í•˜ë“œì½”ë”© ì—†ìŒ
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ì ì ˆí•¨
- [ ] Rate limiting ì ìš©ë¨
- [ ] ì…ë ¥ ê²€ì¦ ì ìš©ë¨

### ë¹Œë“œ ì „ í™•ì¸
```bash
npm run lint
npm run build
npm audit
```

---

## ë°°í¬

### Vercel ì„¤ì •
- í™˜ê²½ ë³€ìˆ˜ëŠ” Vercel ëŒ€ì‹œë³´ë“œì—ì„œ ì„¤ì •
- Production, Preview, Development í™˜ê²½ ë¶„ë¦¬
- ë°°í¬ í›„ ë°˜ë“œì‹œ Redeployë¡œ í™˜ê²½ ë³€ìˆ˜ ì ìš©

### í”„ë¦¬í‹°ì–´ ìµœì í™”
- í•¨ìˆ˜ íƒ€ì„ì•„ì›ƒ: 10ì´ˆ ì´ë‚´
- ë©”ëª¨ë¦¬: 1024MB
- ë¹ ë¥¸ ì‹¤íŒ¨: ì…ë ¥ ê²€ì¦ ë¨¼ì € ìˆ˜í–‰

---

## ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§

### ë¡œê¹… ê·œì¹™
- í”„ë¡œë•ì…˜: warn, error ë ˆë²¨ë§Œ
- ë¯¼ê° ì •ë³´ í•„í„°ë§ í•„ìˆ˜
- ë¡œê·¸ ê¸¸ì´ ì œí•œ: 1000ì

### ëª¨ë‹ˆí„°ë§ ëŒ€ìƒ
| í•­ëª© | ì„¤ëª… | ì„ê³„ê°’ |
|------|------|--------|
| API ì‘ë‹µ ì‹œê°„ | í‰ê·  ì‘ë‹µ ì‹œê°„ | 5ì´ˆ ì´ìƒ ê²½ê³  |
| ì—ëŸ¬ìœ¨ | API ì—ëŸ¬ ë¹„ìœ¨ | 5% ì´ìƒ ê²½ê³  |
| Rate Limit | ì œí•œ ì´ˆê³¼ íšŸìˆ˜ | ëª¨ë‹ˆí„°ë§ |

---

## ê¸ˆì§€ ì‚¬í•­ ìš”ì•½

### ì ˆëŒ€ ê¸ˆì§€
- ğŸš« API í‚¤, ë¹„ë°€ë²ˆí˜¸ í•˜ë“œì½”ë”©
- ğŸš« .env íŒŒì¼ Git ì»¤ë°‹
- ğŸš« eval(), new Function() ì‚¬ìš©
- ğŸš« SQL String Concatenation
- ğŸš« HTTP ì‚¬ìš© (HTTPS í•„ìˆ˜)
- ğŸš« ë¯¼ê° ì •ë³´ ë¡œê¹…
- ğŸš« any íƒ€ì… ë‚¨ìš©
- ğŸš« escape ì—†ì´ dangerouslySetInnerHTML ì‚¬ìš©

---

## ì°¸ê³  ë¬¸ì„œ

- [Next.js 14 Documentation](https://nextjs.org/docs)
- [NextAuth.js Documentation](https://next-auth.js.org)
- [Prisma Documentation](https://www.prisma.io/docs)
- [ShadCN UI](https://ui.shadcn.com)
- [OWASP Top 10](https://owasp.org/Top10/)
- [SECURITY.md](./SECURITY.md)
